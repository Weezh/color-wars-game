import{j as s,r as c,e as P,a as D,u as $,b as O}from"./index-CNtd4s_S.js";const W=n=>s.jsx("span",{className:`dice bg-player${n.player}`,children:s.jsxs("span",{className:"",children:[s.jsxs("span",{className:"flex",children:[s.jsx("span",{className:"dice-circle"}),n.DiceNumber>=2?s.jsx("span",{className:"dice-circle"}):void 0]}),n.DiceNumber>=3?s.jsxs("span",{className:`m-0 p-0 ${n.DiceNumber>3?"flex":"block"}`,children:[s.jsx("span",{className:"dice-circle"}),n.DiceNumber>=4?s.jsx("span",{className:"dice-circle"}):void 0]}):void 0]})}),L=n=>{const r=()=>{n.isWaiting||n.onClick(n.currentState)};return s.jsx("button",{onClick:r,className:`btn cell ${n.className??""}`,children:n.currentState.player!=null&&n.currentState.state>0?s.jsx(W,{player:n.currentState.player,DiceNumber:n.currentState.state}):void 0})},R=({size:n,currentPlayer:r,setCurrentPlayer:v,maxPlayers:f,setIsFinished:y})=>{const[d,m]=c.useState([]),[h,N]=c.useState(),[b,g]=c.useState(!1),[o,j]=c.useState([]),[p,u]=c.useState(!1),k=()=>{console.log("--------------------------------"),console.log("Initialing game..."),console.log("--------------------------------");const e=[];for(let t=0;t<n;t++){const l=[];for(let a=0;a<n;a++)l.push({player:null,state:0,rowIndex:t,cellIndex:a});e.push(l)}m(e)},C=()=>{const e=[];d.forEach((t,l)=>{const a=[];t.forEach(i=>{const x=`cell_${i.rowIndex}_${i.cellIndex}`;a.push(s.jsx(L,{isWaiting:p,currentState:i,onClick:E},x))}),e.push(s.jsx("div",{className:"row",children:a},`row_${l}`))}),N(e),g(!0)};c.useEffect(()=>{b||k()},[b]),c.useEffect(()=>{C(),I()},[d]),c.useEffect(()=>{I(),o.length==f&&o.filter(e=>!e.isOut).length==1&&y(!0)},[o]);const E=e=>{if(d.length===0||!d[e.rowIndex]||!d[e.rowIndex][e.cellIndex])return alert("something happen");let t=!1;if(e.player==null||e.player==r){if(e.player==null&&o.find(x=>x.playerNumber==r))return;new Audio("/src/assets/sounds/click.mp3").play().then(()=>{}),e.player==null&&!o.find(x=>x.playerNumber==r)&&(j(x=>[...x,{playerNumber:r,initialRowIndex:e.rowIndex,initialCellIndex:e.cellIndex,isOut:!1}]),t=!0);const a=[...d],i={...e,player:r,state:t?3:e.state+1};a[e.rowIndex][e.cellIndex]=i,m(a),i.state==4&&(u(!0),S(i,a),u(!1)),z()}},z=()=>{I();let e=r+1>f?1:r+1;for(let t=0;t<1/0;t++){const l=o.find(a=>a.playerNumber==e);if(l&&l.isOut){e=e+1>f?1:e+1;continue}v(e);break}o.length==f&&o.filter(t=>!t.isOut).length==1&&y(!0)},I=()=>{if(o.length==f){const e=Array.from({length:f},(a,i)=>i+1),t=[];if(d.forEach(a=>{a.forEach(i=>{i.player!=null&&!t.includes(i.player)&&t.push(i.player)})}),t.length==0)return;const l=P(e,t);l.length&&l.forEach(a=>{const i=o.map(x=>(a==x.playerNumber&&(x.isOut=!0),x));j(i)})}},S=(e,t)=>{const l=[...t];l[e.rowIndex][e.cellIndex]={...e,player:null,state:0},w(e.rowIndex,e.cellIndex+1,l),w(e.rowIndex,e.cellIndex-1,l),w(e.rowIndex-1,e.cellIndex,l),w(e.rowIndex+1,e.cellIndex,l),m(l)},w=(e,t,l)=>{if(l[e]&&l[e][t]){const a=l[e][t],i={...a,player:r,state:a.state+1>4?4:a.state+1};l[e][t]=i,i.state==4&&S(i,l)}};return b?s.jsx("div",{className:"board",children:h}):s.jsx("div",{className:"text-white",children:"Loading..."})},_=()=>{const[n]=D(),[r,v]=c.useState(1),[f,y]=c.useState(!1),[d,m]=c.useState(),[h,N]=c.useState(),b=$(),[g,o]=O();c.useEffect(()=>{if(h&&h>5){let p=(o<g?o:g)/h-h/2;p>4*16&&(p=4*16),document.documentElement.style.setProperty("--boardItemSize",p.toString()+"px")}},[h,g,o]),c.useEffect(()=>{try{if(n.has("p")){const u=parseInt(n.get("p")??"2");u<=4||u>=2?m(u):m(2)}}catch{}try{if(n.has("s")){const u=parseInt(n.get("s")??"5");[5,7,10].includes(u)?N(u):N(5)}}catch(u){console.log("Size: "+u)}new Audio("/src/assets/sounds/whistle.mp3").play().then(()=>{})},[]),c.useEffect(()=>{document.body.className="bg-player"+r},[r]);const j=()=>{confirm("are you sure?")&&b("/")};return!h||!d?s.jsx("div",{className:"absolute glass bg-opacity-40 flex flex-col w-screen h-screen justify-center items-center",children:s.jsx("h2",{className:"text-black",children:"Loading..."})}):s.jsxs("div",{className:"game-page relative flex flex-col justify-center items-center",children:[s.jsx("div",{id:"rotated-device",className:"absolute inset-0 justify-center items-center bg-white z-20",children:s.jsx("p",{children:"Please rotate your phone!"})}),s.jsx("h3",{className:`text-white mb-4 inline-block text-center ${f?"bg-success":"bg-neutral-700"} py-2 px-4 rounded-xl`,children:f?s.jsx("span",{children:"Player won!"}):s.jsxs("span",{children:["Current Player: ",s.jsx("span",{className:"",children:r})]})}),s.jsx("div",{className:"flex w-screen absolute top-[20px] justify-center left-0 right-0",children:s.jsx("button",{onClick:j,className:"btn-close btn btn-circle btn-outline border-white fill-white",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})}),s.jsxs("div",{className:"bg-neutral-700 flex items-center absolute top-[30px] left-0 p-2 rounded-br-2xl rounded-tr-2xl",children:[s.jsx("div",{className:"mr-4 rounded-full w-[30px] h-[30px] bg-player1"}),s.jsx("p",{className:"mr-2 text-white",children:"Player 1"})]}),d>=3?s.jsxs("div",{className:"bg-neutral-700 flex items-center absolute top-[30px] right-0 p-2 rounded-bl-2xl rounded-tl-2xl",children:[s.jsx("p",{className:"ml-2 text-white",children:"Player 3"}),s.jsx("div",{className:"ml-4 rounded-full w-[30px] h-[30px] bg-player3"})]}):void 0,s.jsxs("div",{className:"bg-neutral-700 flex items-center absolute bottom-[30px] right-0 p-2 rounded-bl-2xl rounded-tl-2xl",children:[s.jsx("p",{className:"ml-2 text-white",children:"Player 2"}),s.jsx("div",{className:"ml-4 rounded-full w-[30px] h-[30px] bg-player2"})]}),d==4?s.jsxs("div",{className:"bg-neutral-700 flex items-center absolute bottom-[30px] left-0 p-2 rounded-br-2xl rounded-tr-2xl",children:[s.jsx("div",{className:"mr-4 rounded-full w-[30px] h-[30px] bg-player4"}),s.jsx("p",{className:"mr-2 text-white",children:"Player 4"})]}):void 0,s.jsx(R,{maxPlayers:d,setIsFinished:y,currentPlayer:r,setCurrentPlayer:v,size:h}),f?s.jsx("div",{className:"",children:s.jsx("button",{onClick:j,className:"btn btn-success text-white mt-2",children:"Reset"})}):void 0]})};export{_ as default};
